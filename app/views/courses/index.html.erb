
<% content_for :header do %>
<h1><%= t ".Paul"%></h1>
<% end %>
<input type="search" name="search" autocomplete="off" placeholder="Search..." id="search_id" value="" />
<script>
$('#page').live( 'pageinit', function(event) {
  //TODO: port this to coffee script :)

  
  var search_field = $("#search_id");
  var result_list = $("#courses_result_list");
  search_field.bind( "change", function(event, ui) {
    if(search_field.val().length == 0)
      result_list.empty();
  });
  var search_timer = null;
  search_field.keyup(function() {
    if(search_field.val().length == 0)
      result_list.empty();
    if(search_field.val().length < 3)
      return;
    if (search_timer)
      clearTimeout(search_timer);
    search_timer = setTimeout(function() 
    {
      $.getJSON('/courses/search/' + encodeURIComponent(search_field.val()), function(data)
      {
        result_list.empty();
        $.each(data, function() { 
          var li = $('<li>');
          var link = $('<a data-icon="arrow-r">');
          link.append($('<h3>' + this.course.title + '</h3>'));
          var id = this.course.id;
          link.attr('href', '/courses/' + encodeURIComponent(id));
          var next_class = this.course.next_class;
          if(next_class)
          {
            var infos = $('<p>');
            infos.html('Next class: ' + next_class.date + 
             ' from ' + next_class.time_from + 
             ' to ' + next_class.time_to + 
             ' at ' + next_class.room );
            link.append(infos);
          }
          li.append(link);
          result_list.append(li);
        });
        result_list.listview('refresh');
      }); 
    }, 
    500);
  });
});
</script>
<ul data-role="listview" id="courses_result_list">
</ul>

