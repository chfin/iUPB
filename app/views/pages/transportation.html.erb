<%= content_for "page-attributes" do %>id="transportPage"<% end %>
<% content_for :header do %>
<h1><%= t "layouts.application.buses"%> <a href="#" id="reload-button"><i class="icon-refresh"></i></a></h1>
<% end %>
<script>
$(document).ready(function(event) {
  var load_buses = function()
  {
    $.ajax({ 
      url: "https://upbapi.cloudcontrolled.com/busplan.php?callback=?",
      dataType: "jsonp",
      type: "GET",
      jsonp: true,
      cache: true,
      jsonpCallback: "success", 
      success: function(data){
      var list = $("#bus_data_list");
      list.empty();
      for(var i = 0; i < data.length; i++)
      {
        var list_item = $('<li class="well"><h4>'
         + I18n.t("transportation.index.trip_at", {
            "station" : data[i].station, 
            "date" : I18n.l("time.formats.very_short", data[i].date)
           }) 
         + '</h4><h5>'
         + I18n.t("transportation.index.line") 
         + ' <span class="badge badge-info">' 
         + data[i].line 
         + '</span>  ' 
         + I18n.t("transportation.index.to") 
         + ' <span class="label label-info">' 
         + data[i].direction 
         + '</span></h5></li>');
  			list.append(list_item);
      }
    }});
  };
  load_buses();
  $("#reload-button").bind("click", function(e){
    load_buses();
	  e.preventDefault();
  });
});
</script>
<ul id="bus_data_list" class="no-bullets no-left-margin">
  <li>
    <h3><%= t "please_wait" %></h3>
    </li>
</ul>
<p class="source-info">
	Aktuelle Daten: <a target="_blank" href="http://www.vrr.de/de/index.html">Verkehrsverbund Rhein-Ruhr</a>.
</p>

